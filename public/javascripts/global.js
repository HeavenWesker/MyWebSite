/*! MyWebSite - v0.0.0 - 2015-06-14
* Copyright (c) 2015 Heaven Wesker; Licensed  */
function propulateTable(){$.getJSON("/users/userlist",function(a){var b="";userListData=a,$.each(a,function(){b+="<tr>",b+='<td><a href="#" class="linkshowuser" rel="'+this.username+'">'+this.username+"</td>",b+="<td>"+this.email+"</td>",b+='<td><a href="#" class="linkdeleteuser" rel="'+this._id+'">delete</a></td>',b+="</tr>"}),$("#userList table tbody").html(b)})}function errAlert(a){alert("Error"+a)}function showUserInfo(a){a.preventDefault();var b=$(this).attr("rel"),c=userListData.map(function(a){return a.username}).indexOf(b),d=userListData[c];$("#userInfoName").text(d.username),$("#userInfoAge").text(d.age),$("#userInfoGender").text(d.gender),$("#userInfoLocation").text(d.location),$("#updateUser #inputUserId").val(d._id),$("#updateUser #input-username").val(d.username),$("#updateUser #input-user-email").val(d.email),$("#updateUser #inputUserFullName").val(d.fullname),$("#updateUser #inputUserAge").val(d.age),$("#updateUser #inputUserGender").val(d.gender),$("#updateUser #inputUserLocation").val(d.location)}function addUser(a){a.preventDefault();var b=0;if($("#addUser input").each(function(){""===$(this).val()&&b++}),0===b){var c={username:$("#addUser input#input-username").val(),email:$("#addUser input#input-user-email").val(),fullname:$("#addUser input#inputUserFullName").val(),age:$("#addUser input#inputUserAge").val(),gender:$("#addUser input#inputUserGender").val(),location:$("#addUser input#inputUserLocation").val()};$.ajax({method:"POST",data:c,url:"/users/adduser",dataType:"JSON"}).done(function(a){void 0===a.err?($("#addUser input").val(""),propulateTable()):alert("Error: "+a.err)})}else alert("Error, please input all information")}function deleteUser(a){a.preventDefault(),$.ajax({method:"DELETE",url:"/users/deleteuser/"+$(this).attr("rel")}).done(function(a){null!==a.err&&0!==a.msg.n?propulateTable():errAlert(a.err)})}function updateUser(a){a.preventDefault(),""!==$("#updateUser input#inputUserId").val()&&$.ajax({method:"PUT",url:"/users/updateuser/"+$("#updateUser #inputUserId").val(),data:{username:$("#updateUser #input-username").val(),email:$("#updateUser #input-user-email").val(),fullname:$("#updateUser #inputUserFullName").val(),age:$("#updateUser #inputUserAge").val(),gender:$("#updateUser #inputUserGender").val(),location:$("#updateUser #inputUserLocation").val()}}).done(function(a){""===a.msg?propulateTable():alert("Error: update not successed")})}function getMonthWord(a){return 0===a?"Jan":1===a?"Feb":2===a?"Mar":3===a?"Apr":4===a?"May":5===a?"Jun":6===a?"Jul":7===a?"Aug":8===a?"Sep":9===a?"Oct":10===a?"Nov":11===a?"Dec":void 0}function loadMorePosts(a){if(console.log("force"),console.log(void 0!==a),void 0===a&&(window.noMorePosts===!0||window.updating===!0||window.errorHappened===!0))return void console.log("stop");$("#error-notification").remove(),window.updating=!0,$(".spinner").show();var b={};b.action="old",b.oldid=$(".post").last().attr("id").substring(5),$.ajax({dataType:"JSON",url:"/posts/postlist",data:b}).done(function(a){if(void 0===a.err){window.errorHappened=!1,0===a.length&&(window.noMorePosts=!0),console.log(a);for(var b=0;b<a.length;b++){var c=new Date(a[b].ISODate);$("#post-list").append('<div id="post-'+a[b]._id+'" class="post"><img src="/images/headers/'+a[b].header_image+'.png" class="header-image"><a class="post-title" href="/post/'+a[b]._id+'">'+a[b].title+'</a><p class="post-date">'+c.getFullYear()+"-"+getMonthWord(c.getMonth())+"-"+c.getDate()+"</p></div>")}}}).fail(function(){window.errorHappened=!0,$(".spinner").before('<div id="error-notification">Network Error<a onclick="loadMorePosts(true)">TryAgain</a></div>')}).always(function(){$(".spinner").hide(),window.updating=!1})}var userListData=[];$(document).ready(function(){$("#pageControl").hide()});